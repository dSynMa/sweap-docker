# Replication instructions

## Legal preliminaries

Make sure you have read `/LICENSE`, `containers/LICENSE`, and `DISCLAIMER`.

In short:

* The `Dockerfile`s themselves are BDS-licensed.
* The source code for `sweap` itself is provided without a license and thus is (c) its authors.
* The *image* that will be generated by following this guide may only be used for the purpose of artifact evaluation
* The image will contain a copy of `nuxmv`. This means you can *build* the image from scratch but cannot *redistribute* it, due to limitation imposed by `nuxmv`'s license.
* Using this version of `sweap` for any other purpose requires explicit consent by the copyright holders.

## Building the image

We recommend using Podman. We provide a `make` recipe to build a Docker image, but have not tested it extensively.

From the root directory, invoke:

```bash
make artifact-podman
```

This will build a Podman image called `sweap-artifact` using the `containers/Dockerfile` description.

To check that the build has completed successfully, invoke:

```bash
podman image ls 
```

The output should contain something like the following:

```
REPOSITORY                        TAG         IMAGE ID      CREATED       SIZE
...
localhost/sweap-artifact             latest      ...
...
```

## Running experiments

From the `containers` directory:

```bash
podman run  --memory 16G --interactive -t -v ./benchmarks:/benchmarks localhost/sweap-artifact:latest make [tool]
```

Where `[tool]` is one of `sweap, sweap-noacc, sweap-nobin, rpgsolve, rpgsolve-syn, rpg-stela, tslmt2rpg, tslmt2rpg-syn, raboniel, temos`

This runs `[tool]` on benchmarks taken from the `benchmarks/[tool]` directory, and generates a `benchmarks/[tool]/.../[bench].[tool].log` file for every completed experiment. It will also skip any benchmark for which a log already exists.

Special shortcuts are `make all` (every tool except `temos` and `sweap-nobin`)
and `make everything` (every tool).

This will give every experiment a time limit of 1200'' (20 minutes). For shorter timeouts, use e.g.,

```bash
podman run ... make [tool] TIMEOUT=120  # For a 2' timeout
```

Notice that this might partially affect some scripts in the next section, which expect a 20' timeout.

## Generating tables and plots

Run in this order:

```bash
podman run --interactive -t -v ./benchmarks:/benchmarks localhost/sweap-artifact:latest make tables
podman run --interactive -t -v ./benchmarks:/benchmarks localhost/sweap-artifact:latest make plots
```

This will generate several `.tex` and `.pdf` files and a `.csv` under `benchmarks/results`.

Optionally, you may compile `benchmarks/results/main.tex` to obtain a PDF of the results,
using the traditional workflow:

```bash
cd benchmarks/results
pdflatex main
bibtex main
pdflatex main
pdflatex main
```

## Running sweap manually

To run sweap manually, use:

```bash
podman run --interactive -t -v [...bind mount...] localhost/sweap-artifact:latest sweap --synthesise --p /path/to/file.prog
```

Notice that you will need to bind the directory of your `.prog` file, so that the container can find it. Here, for instance, we kept the `benchmarks` bind. An example:

```bash
podman run --interactive -t -v ./benchmarks:/benchmarks localhost/sweap-artifact:latest sweap --synthesise --p /benchmarks/sweap/full-ltl/elevator-paper.prog
```

When it terminates, Sweap prints:

* `Realizable.`, followed by a controller in HOA format, if it manages to synthesise a controller;
* or `Unrealizable.`, followed by a counterstrategy in DOT format, if it determines that the problem is unrealizable.